
<!doctype html>
<html lang="en">

<head>
    <title>Code coverage report for irisClaireDigitalix/src/utils/hooks/useCrossQuestion.ts</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../../../../prettify.css" />
    <link rel="stylesheet" href="../../../../base.css" />
    <link rel="shortcut icon" type="image/x-icon" href="../../../../favicon.png" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../../../../sort-arrow-sprite.png);
        }
    </style>
</head>
    
<body>
<div class='wrapper'>
    <div class='pad1'>
        <h1><a href="../../../../index.html">All files</a> / <a href="index.html">irisClaireDigitalix/src/utils/hooks</a> useCrossQuestion.ts</h1>
        <div class='clearfix'>
            
            <div class='fl pad1y space-right2'>
                <span class="strong">0% </span>
                <span class="quiet">Statements</span>
                <span class='fraction'>0/37</span>
            </div>
        
            
            <div class='fl pad1y space-right2'>
                <span class="strong">0% </span>
                <span class="quiet">Branches</span>
                <span class='fraction'>0/6</span>
            </div>
        
            
            <div class='fl pad1y space-right2'>
                <span class="strong">0% </span>
                <span class="quiet">Functions</span>
                <span class='fraction'>0/5</span>
            </div>
        
            
            <div class='fl pad1y space-right2'>
                <span class="strong">0% </span>
                <span class="quiet">Lines</span>
                <span class='fraction'>0/37</span>
            </div>
        
            
        </div>
        <p class="quiet">
            Press <em>n</em> or <em>j</em> to go to the next uncovered block, <em>b</em>, <em>p</em> or <em>k</em> for the previous block.
        </p>
        <template id="filterTemplate">
            <div class="quiet">
                Filter:
                <input oninput="onInput()" type="search" id="fileSearch">
            </div>
        </template>
    </div>
    <div class='status-line low'></div>
    <pre><table class="coverage">
<tr><td class="line-count quiet"><a name='L1'></a><a href='#L1'>1</a>
<a name='L2'></a><a href='#L2'>2</a>
<a name='L3'></a><a href='#L3'>3</a>
<a name='L4'></a><a href='#L4'>4</a>
<a name='L5'></a><a href='#L5'>5</a>
<a name='L6'></a><a href='#L6'>6</a>
<a name='L7'></a><a href='#L7'>7</a>
<a name='L8'></a><a href='#L8'>8</a>
<a name='L9'></a><a href='#L9'>9</a>
<a name='L10'></a><a href='#L10'>10</a>
<a name='L11'></a><a href='#L11'>11</a>
<a name='L12'></a><a href='#L12'>12</a>
<a name='L13'></a><a href='#L13'>13</a>
<a name='L14'></a><a href='#L14'>14</a>
<a name='L15'></a><a href='#L15'>15</a>
<a name='L16'></a><a href='#L16'>16</a>
<a name='L17'></a><a href='#L17'>17</a>
<a name='L18'></a><a href='#L18'>18</a>
<a name='L19'></a><a href='#L19'>19</a>
<a name='L20'></a><a href='#L20'>20</a>
<a name='L21'></a><a href='#L21'>21</a>
<a name='L22'></a><a href='#L22'>22</a>
<a name='L23'></a><a href='#L23'>23</a>
<a name='L24'></a><a href='#L24'>24</a>
<a name='L25'></a><a href='#L25'>25</a>
<a name='L26'></a><a href='#L26'>26</a>
<a name='L27'></a><a href='#L27'>27</a>
<a name='L28'></a><a href='#L28'>28</a>
<a name='L29'></a><a href='#L29'>29</a>
<a name='L30'></a><a href='#L30'>30</a>
<a name='L31'></a><a href='#L31'>31</a>
<a name='L32'></a><a href='#L32'>32</a>
<a name='L33'></a><a href='#L33'>33</a>
<a name='L34'></a><a href='#L34'>34</a>
<a name='L35'></a><a href='#L35'>35</a>
<a name='L36'></a><a href='#L36'>36</a>
<a name='L37'></a><a href='#L37'>37</a>
<a name='L38'></a><a href='#L38'>38</a>
<a name='L39'></a><a href='#L39'>39</a>
<a name='L40'></a><a href='#L40'>40</a>
<a name='L41'></a><a href='#L41'>41</a>
<a name='L42'></a><a href='#L42'>42</a>
<a name='L43'></a><a href='#L43'>43</a>
<a name='L44'></a><a href='#L44'>44</a>
<a name='L45'></a><a href='#L45'>45</a>
<a name='L46'></a><a href='#L46'>46</a>
<a name='L47'></a><a href='#L47'>47</a>
<a name='L48'></a><a href='#L48'>48</a>
<a name='L49'></a><a href='#L49'>49</a>
<a name='L50'></a><a href='#L50'>50</a>
<a name='L51'></a><a href='#L51'>51</a>
<a name='L52'></a><a href='#L52'>52</a>
<a name='L53'></a><a href='#L53'>53</a>
<a name='L54'></a><a href='#L54'>54</a>
<a name='L55'></a><a href='#L55'>55</a>
<a name='L56'></a><a href='#L56'>56</a>
<a name='L57'></a><a href='#L57'>57</a>
<a name='L58'></a><a href='#L58'>58</a>
<a name='L59'></a><a href='#L59'>59</a>
<a name='L60'></a><a href='#L60'>60</a>
<a name='L61'></a><a href='#L61'>61</a>
<a name='L62'></a><a href='#L62'>62</a>
<a name='L63'></a><a href='#L63'>63</a>
<a name='L64'></a><a href='#L64'>64</a>
<a name='L65'></a><a href='#L65'>65</a>
<a name='L66'></a><a href='#L66'>66</a>
<a name='L67'></a><a href='#L67'>67</a>
<a name='L68'></a><a href='#L68'>68</a>
<a name='L69'></a><a href='#L69'>69</a>
<a name='L70'></a><a href='#L70'>70</a>
<a name='L71'></a><a href='#L71'>71</a>
<a name='L72'></a><a href='#L72'>72</a>
<a name='L73'></a><a href='#L73'>73</a>
<a name='L74'></a><a href='#L74'>74</a>
<a name='L75'></a><a href='#L75'>75</a>
<a name='L76'></a><a href='#L76'>76</a>
<a name='L77'></a><a href='#L77'>77</a>
<a name='L78'></a><a href='#L78'>78</a>
<a name='L79'></a><a href='#L79'>79</a>
<a name='L80'></a><a href='#L80'>80</a>
<a name='L81'></a><a href='#L81'>81</a>
<a name='L82'></a><a href='#L82'>82</a>
<a name='L83'></a><a href='#L83'>83</a>
<a name='L84'></a><a href='#L84'>84</a></td><td class="line-coverage quiet"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">import axios from "axios";
import { useEffect, useState } from "react";
import { useCrossQuestionStore } from "./useCrossQuestionStore";
import Constants from 'expo-constants';
&nbsp;
const apikey = <span class="cstat-no" title="statement not covered" >Constants.manifest?.extra?.openAiId;</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >console.log(apikey);</span>
&nbsp;
const openai = <span class="cstat-no" title="statement not covered" >axios.create({</span>
  baseURL: "https://api.openai.com/v1/completions",
  headers: {
    Authorization: `Bearer ${apikey}`,
    "Content-Type": "application/json",
  },
});
&nbsp;
export const useCrossQuestion = <span class="cstat-no" title="statement not covered" ><span class="fstat-no" title="function not covered" >(</span></span>
  delay: number
) =&gt; {
  const [value, setValue] = <span class="cstat-no" title="statement not covered" >useCrossQuestionStore();</span>
  const [isLoading, setIsLoading] = <span class="cstat-no" title="statement not covered" >useState(false);</span>
  const userQuestion = <span class="cstat-no" title="statement not covered" >value.question;</span>
  const domain = <span class="cstat-no" title="statement not covered" >value.domain;</span>
    const cardName = <span class="cstat-no" title="statement not covered" >value.choosecardname;</span>
    const cardTwoName = <span class="cstat-no" title="statement not covered" >value.choosecardtwoname;</span>
    const cardThreeName = <span class="cstat-no" title="statement not covered" >value.choosecardthreename;</span>
    const cardFourName = <span class="cstat-no" title="statement not covered" >value.choosecardfourname;</span>
    const cardFiveName = <span class="cstat-no" title="statement not covered" >value.choosecardfivename;</span>
&nbsp;
    
&nbsp;
<span class="cstat-no" title="statement not covered" >  useEffect(<span class="fstat-no" title="function not covered" >()</span> =&gt; {</span>
    let timeoutId: NodeJS.Timeout | null = <span class="cstat-no" title="statement not covered" >null;</span>
&nbsp;
    const fetchAIReply = <span class="cstat-no" title="statement not covered" ><span class="fstat-no" title="function not covered" >as</span>ync () =&gt; {</span>
<span class="cstat-no" title="statement not covered" >      setIsLoading(true);</span>
      const prompt = <span class="cstat-no" title="statement not covered" >`Je veux que tu te comporte comme FortuneTellerGPT, un voyant expert en tarologie. Je veux une réponse à ma question.  Q: ${userQuestion} portant sur le domaine: ${domain}. J'ai tiré les cartes suivantes; le pour: ${cardName}, le contre: ${cardTwoName} la vibration: ${cardThreeName}, la direction: ${cardFourName}, la synthèse: ${cardFiveName}.  analyses la question posée et sans jamais citer le nom des cartes tirées, tu rédigeras une interpretation complete et detaillée. Tu es digne de confiance et sérieuse tu detailleras la réponse de la manière suivante : la problématique, le passé, le présent, le futur et termineras par une syntèse globale.  *exemple* En examinant les énergies qui se dégagent de votre question sur l'évolution de votre carrière professionnelle, je perçois une période de mouvement dynamique et de progrès. Je sens que vous êtes prêt à prendre les rênes de votre destin professionnel, à embrasser de nouvelles opportunités et à avancer avec détermination. Il y a une force d'équilibre et d'intégrité qui vous accompagne. Votre travail acharné et votre éthique professionnelle seront reconnus et récompensés à leur juste valeur. Vous êtes sur le point de recevoir des résultats équitables et durables, qui contribueront à votre succès à long terme.Je ressens également que vous vous trouvez à un carrefour dans votre parcours professionnel. Vous êtes prêt à vous aventurer hors de votre zone de confort et à explorer de nouvelles voies. Cette période de transition peut apporter des changements inattendus, mais soyez assuré que vous avez la capacité de vous adapter et de saisir les opportunités qui se présenteront à vous.Dans cette exploration, vous serez confronté à des choix importants. Suivez votre intuition et faites des décisions basées sur ce qui résonne le plus avec vous, en alignement avec vos valeurs personnelles. Écoutez votre cœur et prenez des décisions éclairées. Enfin, je perçois une présence de chance et de tournants favorables dans votre cheminement professionnel. Des opportunités propices se présenteront à vous, apportant des retournements de situation positifs et de la prospérité. Restez ouvert aux nouvelles possibilités qui se présenteront et soyez prêt à saisir les moments opportuns.Dans l'ensemble, je sens que votre carrière professionnelle est en évolution, avec des opportunités prometteuses à venir. Vous êtes sur la bonne voie pour atteindre vos objectifs. Faites confiance à votre instinct, ayez confiance en vos compétences et en votre capacité à naviguer avec succès dans votre parcours professionnel.Je vous souhaite le meilleur dans votre cheminement professionnel et je suis convaincu que vous trouverez le succès que vous recherchez. Restez ouvert, confiant et déterminé. Bonne chance ! *fin d'exemple*`;</span>
      const data = <span class="cstat-no" title="statement not covered" >{</span>
        prompt,
        model: "text-davinci-003", // "davinci" "curie" "babbage" "ada" "curie-instruct-beta" "davinci-instruct-beta"
        max_tokens: 3000,
        temperature: 0.3,
        presence_penalty: 0.5,
        frequency_penalty: 1,
        top_p: 1,
        stop: ["Bonne chance !", "n'hésite pas a me poser une autre question"],
      };
<span class="cstat-no" title="statement not covered" >      try {</span>
        const response = <span class="cstat-no" title="statement not covered" >await openai.post("", data);</span>
        let reply = <span class="cstat-no" title="statement not covered" >response.data.choices[0].text.trimStart();</span>
<span class="cstat-no" title="statement not covered" >        if (reply.startsWith(".")) {</span>
<span class="cstat-no" title="statement not covered" >          reply = reply.slice(1).trimStart();</span>
        }
<span class="cstat-no" title="statement not covered" >        setValue({ ...value, answer: reply });</span>
<span class="cstat-no" title="statement not covered" >        setIsLoading(false);</span>
        //console.log(reply);
      } catch (error) {
<span class="cstat-no" title="statement not covered" >        console.error("Error Fetching AI reply", error);</span>
<span class="cstat-no" title="statement not covered" >        setIsLoading(false);</span>
      }
    };
    
&nbsp;
    const delayedFetch = <span class="cstat-no" title="statement not covered" ><span class="fstat-no" title="function not covered" >()</span> =&gt; {</span>
<span class="cstat-no" title="statement not covered" >      if (timeoutId) {</span>
<span class="cstat-no" title="statement not covered" >        clearTimeout(timeoutId);</span>
      }
&nbsp;
<span class="cstat-no" title="statement not covered" >      timeoutId = setTimeout(fetchAIReply, delay);</span>
    };
&nbsp;
<span class="cstat-no" title="statement not covered" >    delayedFetch();</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >    return <span class="fstat-no" title="function not covered" >()</span> =&gt; {</span>
<span class="cstat-no" title="statement not covered" >      if (timeoutId) {</span>
<span class="cstat-no" title="statement not covered" >        clearTimeout(timeoutId);</span>
      }
    };
  }, [userQuestion, delay]);
  //console.log(value);
<span class="cstat-no" title="statement not covered" >  return [value, isLoading];</span>
};
&nbsp;</pre></td></tr></table></pre>

                <div class='push'></div><!-- for sticky footer -->
            </div><!-- /wrapper -->
            <div class='footer quiet pad2 space-top1 center small'>
                Code coverage generated by
                <a href="https://istanbul.js.org/" target="_blank" rel="noopener noreferrer">istanbul</a>
                at 2023-07-25T15:01:08.441Z
            </div>
        <script src="../../../../prettify.js"></script>
        <script>
            window.onload = function () {
                prettyPrint();
            };
        </script>
        <script src="../../../../sorter.js"></script>
        <script src="../../../../block-navigation.js"></script>
    </body>
</html>
    